/*!
 * wkapi.js 1.2.1
 * (c) 2018-2020 wakedata
 * Released under the MIT License.
 */
var e="wk.20181119.uid",t="wk.20181119.opr",n="onShow",o="onHide",r="onError",a="onLaunch",i={BOOT:"boot",ERROR:"error",APP_HIDE:"app_hide",APP_SHOW:"app_show",LEAVE_PAGE:"page_leave",PAGE_ON_SHOW:"page_onshow",SET_UID:"set_uid",CHANGE_UID:"change_uid",USER:"user_message",AUTH:"user_auth",CLICK:"click",LOCATION:"user_location_message"},c={system:"system",normal:"norm",event:"event"},u={appId:"",appKey:"",uuid:"",opid:"",global:{},tzone:function(){var e=-(new Date).getTimezoneOffset();if("0"!=e&&""!==e&&null!==e){var t=Math.abs(e),n=(Math.floor(t/60).toString().length<2?"0"+Math.floor(t/60).toString():Math.floor(t/60).toString())+":"+((t%60).toString().length<2?"0"+(t%60).toString():(t%60).toString()),o=e>0?"+":"-";return o+n}return""}()};function s(){}var p,l={Page:Page,App:App,Component:Component,getCurrentPages:getCurrentPages},f=wx||{getNetworkType:s,getSystemInfoSync:s,setStorageSync:s,getStorageSync:s,request:s},g=((p=function(){}).setURL_UUID=function(e){e&&(p.URL_UUID=e)},p.setURL_REPORT_REAL_TIME=function(e){e&&(p.URL_REPORT_REAL_TIME=e)},p.setSource=function(e){e&&(p.source=e)},p.URL_UUID="https://stream.wakedata.com/dmp/api/report/uuid",p.URL_REPORT_REAL_TIME="https://stream.wakedata.com/dmp/api/report/realtime",p.source="",p);var d={enable:!1,url:"https://www.wakedata.com/athena/wxappbadreport/recevie"},v={UUID:"uuid",BOOT:"boot",APP_ERROR:"apperror"};function m(e,t){(d.enable||e===v.APP_ERROR)&&f.request({url:d.url+"?scene="+e+"&opt="+encodeURIComponent(JSON.stringify(t))})}var h={};function _(){var e=l.getCurrentPages();if(e&&0!==e.length){var t="";try{t=e&&e[e.length-1]&&e[e.length-1].route}catch(e){}if(t===h.ru)return h;var n={ru:t,lastru:h.ru};return h=Object.assign({},n),n}return{ru:"",lastru:""}}var y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},R=[],b={get:function(e){try{return f.getStorageSync(e)}catch(e){}},set:function(e,t){try{f.setStorageSync(e,t)}catch(e){}}},O={test_flag:0,ableReport:!1,apiUidLossTime:0,appId:null,launch:{sourceappid:"",scene:""},global:y({opid:u.opid,mid:u.uuid,appKey:u.appKey,tzone:u.tzone,device:null,sdk:{version:"1.2.0",type:"wx-app"}},u.global)};function U(){R.length>0&&w.run<w.max&&(w.run+=1,function(e){var t=e.config;!t.bzparm&&T&&(t.bzparm=T);t.global=O.global,(e.getCategory()===i.BOOT||e.getCategory()===i.USER)&&(t.sourceappid=O.launch.sourceappid,t.scene=O.launch.scene);O.test_flag&&(t.test_flag=1);var n=g.URL_REPORT_REAL_TIME+"?appId="+O.appId+"&ts="+ +new Date+"&content="+encodeURIComponent(JSON.stringify(t));g.source&&(n=n+"&source="+g.source);f.request({url:n,success:U,fail:(o=t.event,function(){"boot"===o&&m(v.BOOT,{uuid:O.global.mid})}),complete:I});var o}(R.splice(0,1)[0]))}var w={run:0,max:2};function I(){w.run-=1}function L(e){E(new A(c.system,{event:i.BOOT,parm:{}}));try{e&&e.referrerInfo&&e.referrerInfo.appId&&(O.launch.sourceappid=e.referrerInfo.appId),e&&e.scene&&(O.launch.scene=e.scene)}catch(e){}var n=b.get(t);n?(n-=0,n+=1):n=1e3,b.set(t,n),O.global.opid=n,w.start=+new Date,P()}function S(){var t,n,o,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=r.appId,i=r.appKey,c=r.URL_UUID,u=r.URL_REPORT,s=r.source,p=r.test_flag;return a?i?(O.appId=a,O.global.appKey=i,c&&g.setURL_UUID(c),u&&g.setURL_REPORT_REAL_TIME(u),s&&g.setSource(s),p&&(O.test_flag=1),function(t){var n=b.get(e);if(n)return O.global.mid=n,t();!function n(){O.apiUidLossTime>3||(O.apiUidLossTime+=1,f.request({url:g.URL_UUID,success:function(o){var r=o.data?o.data.data:"";r?(b.set(e,O.global.mid=r),t()):n()},fail:function(e){m(v.UUID,{time:O.apiUidLossTime}),n()}}))}()}(function(){P()}),t=function(e){O.global.device=e,P()},n={},(o=f.getSystemInfoSync())&&function(e,t){t.dp=e.screenWidth+"x"+e.screenHeight,t.model=e.model,t.wxver=e.SDKVersion,t.language=e.language,t.brand=e.brand,t.platform=e.platform;var n=e.system;t.os_ver=n;var o=n.split(" ");o&&o.length&&(t.os=o[0])}(o,n),void f.getNetworkType({success:function(e){e&&e.networkType&&(n.nt=e.networkType)},complete:function(){t(n)}})):console.warn("\u57cb\u70b9\u521d\u59cb\u5316\u5931\u8d25\uff0c\u7f3a\u5c11appKey"):console.warn("\u57cb\u70b9\u521d\u59cb\u5316\u5931\u8d25\uff0c\u7f3a\u5c11appId")}function E(e){setTimeout(function(){R.push(e),O.ableReport?U():P()},0)}function P(){var e=_();e.ru&&O.appId&&O.global.opid&&O.global.mid&&O.global.device&&T&&(R.forEach(function(t){t.config.page_info&&t.config.page_info.ru||(t.config.page_info=e)}),U(),O.ableReport=!0)}function A(e,t){this.category=e,t.event_type=e,t.optime=+new Date,t.page_info=_(),T&&(t.bzparm=T),this.config=t}A.prototype.getCategory=function(){return this.category===c.system||this.category===c.normal?this.config.event:""};var T=null;var C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},k={heatBeatStart:!1,time:0,ru:"",lastru:""};function D(e){!function(e){E(new A(c.system,{event:i.LEAVE_PAGE,parm:C({stay_dur:+new Date-k.time},e||{})}))}(e)}var x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};function B(e,t){E(new A(e,t))}function H(e,t,n){var o=void 0;if(e&&t&&(o=e(n)))return x({},o,{pageKey:t})}var K="ftBuryLoadArgument",N="ftBuryPageKey",z=function(e){var t=this[K],n=this[N];if(!!t&&!!n){var o=H(t,n,e);o?this._buryLoadArg=o:this.__cache_bury_load_msg=e}},M=function(e){console.log("burySdk:PageLife:error",_(),e),B(c.system,{event:i.ERROR,parm:{msg:e}})},j=function(){console.log("burySdk:PageLife:show",_()),k.time=+new Date,B(c.system,{event:i.PAGE_ON_SHOW,parm:{}})},G=function(){var e=this._buryLoadArg;this.__cache_bury_load_msg&&(e=H(this[K],this[N],this.__cache_bury_load_msg)),console.log("burySdk:PageLife:hide",_(),e),D(e)},W=function(e){console.log("burySdk:AppLife:hide",e),B(c.system,{event:i.APP_HIDE,parm:{}})},q=function(){console.log("burySdk:AppLife:show"),B(c.system,{event:i.APP_SHOW,parm:{}})},J={wkBuz:function(e,t){B(c.event,{event:e,parm:t})},wkClick:function(e){B(c.normal,{event:i.CLICK,parm:{x:e.detail.x,y:e.detail.y}})},wkReport:function(e,t,n){B(c.normal,{event:i.CLICK,parm:{x:n.detail.x,y:n.detail.y,key:e,value:t}})},wkHotCatch:function(e){B(c.normal,{event:i.CLICK,parm:{x:e.detail.x,y:e.detail.y}})}};function V(e,t,n){var o=e[t];e[t]=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];n.call.apply(n,[this].concat(t)),o&&o.call.apply(o,[this].concat(t))}}var F=App;App=function(e){V(e,r,M),V(e,a,L),V(e,n,q),V(e,o,W),F.call(this,e)};var Q=Page;Page=function(e){for(var t in J)e[t]=J[t];V(e,"onLoad",z),V(e,"onShow",j),V(e,"onHide",G),V(e,"onUnload",G),Q.call(this,e)};var X=Component;Component=function(e){for(var t in e.methods||(e.methods={}),J)e.methods[t]=J[t];X.call(this,e)};export default{updateRunTimeBzParam:function(e){T=y({},T||{},e)},badJs:{BAD_SCENE:v,openBadReport:function(){d.enable=!0},reportBad:m},config:function(e){S(e)},currentPageInfo:_,report:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e?B(c.event,{event:e,parm:t}):console.warn("\u8bf7\u8f93\u5165\u4e8b\u4ef6\u540d")},reportUser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e){var t={};for(var n in e)t[n]=e[n];O.global.user=t}(e),B(c.normal,{event:i.USER,parm:{user:e,user_profile:t}})},reportAuthOperation:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;B(c.normal,{event:i.AUTH,parm:{result:e?1:0,author_type:t}})},reportLocation:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};B(c.normal,{event:i.LOCATION,parm:e})}};